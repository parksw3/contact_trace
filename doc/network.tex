\documentclass[12pt]{article}
\usepackage[top=1in,left=1in, right = 1in, footskip=1in]{geometry}

\title{Inferring generation-interval distributions from contact tracing data: \\ \emph{in prep, PRSB}}
\author{Sang Woo Park, David Champredon and Jonathan Dushoff}

\usepackage{graphics}
\usepackage{adjustbox}

\newcommand{\eref}[1]{(\ref{eq:#1})}
\newcommand{\fref}[1]{Fig.~\ref{fig:#1}}
\newcommand{\Fref}[1]{Fig.~\ref{fig:#1}}
\newcommand{\sref}[1]{Sec.~\ref{#1}}
\newcommand{\frange}[2]{Fig.~\ref{fig:#1}--\ref{fig:#2}}
\newcommand{\tref}[1]{Table~\ref{tab:#1}}
\newcommand{\tlab}[1]{\label{tab:#1}}

\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}

\usepackage{hyperref}
\usepackage{natbib}
\usepackage{hyperref}
\bibliographystyle{chicago}
\date{\today}

\usepackage{xspace}
\newcommand*{\ie}{i.e.\@\xspace}

\usepackage{color}

\newcommand{\Rx}[1]{\ensuremath{{\mathcal R}_{#1}}} 
\newcommand{\Ro}{\Rx{0}}
\newcommand{\RR}{\ensuremath{{\mathcal R}}}
\newcommand{\Rhat}{\ensuremath{{\hat\RR}}}
\newcommand{\tsub}[2]{#1_{{\textrm{\tiny #2}}}}

\newcommand{\comment}[3]{\textcolor{#1}{\textbf{[#2: }\textsl{#3}\textbf{]}}}
\newcommand{\jd}[1]{\comment{cyan}{JD}{#1}}
\newcommand{\swp}[1]{\comment{magenta}{SWP}{#1}}
\newcommand{\dc}[1]{\comment{blue}{DC}{#1}}
\newcommand{\hotcomment}[1]{\comment{red}{HOT}{#1}}

\begin{document}
\maketitle

\section{Introduction}

%% SWP: see or cite
%% https://www.ncbi.nlm.nih.gov/pubmed/29087987

An epidemic can be characterized by its speed (exponential growth rate, $r$) and its strength (reproductive number, \RR).
Reproductive number, defined as the average number of secondary cases arising from a primary case, is of particular interest as it provides information about the final size of an epidemic \citep{anderson1991infectious, diekmann1990definition}.
However, directly measuring the reproductive number often requires detailed knowledge of the natural history of a disease and may not be feasible early in an epidemic \citep{dietz1993estimation}.
Instead, the reproductive number can be \emph{indirectly} estimated from the exponential growth rate, which can often be estimated from incidence data \citep{chowell2003sars, mills2004transmissibility, nishiura2009transmission, nishiura2010pros, ma2014estimating}.
These two quantities are linked by generation-interval distributions \citep{wearing2005appropriate, wallinga2007generation, roberts2007model,  park2019practical}.

Generation interval is defined as the time between when a person becomes infected and when that person infects another person \citep{svensson2007note}.
Due to individual variation in infection time, the observed generation-interval distribution can change depending on when and how it is measured \citep{svensson2007note, kenah2008generation, nishiura2010time, champredon2015intrinsic}.
There are important distinctions to be made when estimating generation intervals: \emph{intrinsic} generation intervals are measured by evaluating the infectiousness of infected people,
%% without regard to actual infection events,
while \emph{observed} generation intervals refer to the time between actual infection events.
Observed generation intervals in turn can be \emph{aggregated} across time, measured \emph{forward} in time by looking at a cohort of individuals infected at the same time and asking when they infected others, or measured \emph{backward in time} by looking at a cohort and asking when their infectors were infected \citep{champredon2015intrinsic}.
% When aggregated generation intervals are observed until a given time in an ongoing epidemic (often via contact tracing), we refer to these as \emph{censored} (or right-censored) intervals.

Early in an epidemic, when depletion of susceptibles is negligible, we expect the forward generation-interval distribution to be similar to the intrinsic generation-interval distribution \citep{champredon2015intrinsic}.
As an epidemic progresses, an infector is less likely to infect individuals later in time due to decrease in susceptibles, 
and the distribution of forward generation intervals will be shorter than the intrinsic distribution \citep{kenah2008generation, tomba2010some, champredon2015intrinsic}.
Conversely, when an epidemic is growing exponentially, as often occurs near the beginning of an outbreak, the number of newly infected individuals will be large relative to the number infected earlier on. 
A susceptible individual is thus relatively more likely to be infected by a newly infected individual, 
and the distribution of backward generation intervals will be shorter than the intrinsic distribution \citep{champredon2015intrinsic, britton2019estimation}.
When epidemic is subsiding, most infections are caused by the remaining infectors, rather than new infectors, and the backward generation interval will be long \citep{tomba2010some, champredon2015intrinsic}.

In practice, generation intervals are often measured by aggregating available information from contact tracing. 
Whereas forward and backward generation intervals represent infections that are one generation apart from a cohort, these aggregated generation intervals represent infections across multiple cohorts; 
the time of infection of a cohort can range anywhere from the beginning of an epidemic to the most recent infection.
As a result, while an epidemic is ongoing, these measurements are ``censored'': we don't know what happens after the observation time.
These censored observations can be thought of as a weighted average of backward generation-interval distributions; like them, the distribution of censored intervals will have a shorter mean than the intrinsic distribution early in an epidemic.

Realized generation intervals can also vary across space.
In a structured population (that is, any population that does not mix homogeneously), susceptibility will tend to decrease more quickly in the neighborhood of infected individuals than in the general population even in the early phase of an epidemic. 
This means that contacts made late in infection are more likely to be ``masked'' due to infectious contacts that were made earlier.
Therefore, realized generation intervals will be shorter and observed generation intervals may underestimate the intrinsic generation-interval distribution even when population-level susceptibility is very high.
This perspective allows us to reinterpret the finding of \cite{trapman2016inferring} that, given an intrinsic generation interval and an observed growth rate $r$, the reproductive number $\RR$ on various network structures is always smaller on a network than would be predicted from homogeneous mixing.

In this study, we explore spatiotemporal variation in generation intervals measured through contact tracing.
We show that directly using the \emph{observed} generation-interval distributions will generally underestimate the reproductive number \RR, while directly using \emph{intrinsic} generation-interval distributions (i.e., estimated from infectiousness profiles) will tend to overestimate \RR.
We discuss statistical approaches to estimating effective generation-interval distributions and reproductive number of an outbreak from observed generation-interval distributions.
\swp{Come back and fix this}

\section{Intrinsic generation-interval distributions}

\begin{figure}[t]
\includegraphics[width=\textwidth]{../fig/individual_and_population.pdf}
\caption{\textbf{Comparison of individual- and population-level kernels.}
(Left) an individual-level kernel of an infected individual with latent period of 11.4 days followed by infectious period of 5 days. 
(Right) a population-level kernel of infected individuals with latent and infectious periods exponentially distributed with means of 11.4 and 5 days, respectively. 
Shaded areas under the curves are equal to individual- and population-level reproductive numbers, both of which are set to 2 in this example.
}
\label{fig:indpop}

\end{figure}

Generation-interval distributions are often considered as population averages, but we can distinguish population-level distributions from individual-level distributions \citep{svensson2007note, svensson2015influence}; 
making this distinction clear will be particularly useful when we discuss spatial components (see \fref{indpop}).
An individual-level intrinsic kernel $K_a(\tau)$ describes the rate at which secondary infections are expected to be caused by an infected individual $a$.
Individuals may vary in their prognosis (e.g., duration of a latent and an infectious period) and their infectiousness, which can depend both on their intrinsic infectivity as well as their neighborhood.

The population-level kernel is given by integrating over these individual variations:
\begin{equation}
K(\tau) = \int K_a (\tau) dA.
\end{equation}
The population-level kernel describes the rate at which secondary infections are expected to be caused by an \emph{average} infected individual.
Here, we assume that the individual properties are independent of risk of infection.
In practice, it is unlikely that naively averaging across an empirical distribution will give us the correct population-level kernel, especially when an epidemic is driven by a few highly infectious individuals.
\jd{This is assuming that we know how to average across infected individuals. Do we need to assume that individual kernel properties are independent of risk of infection? If we have high-degree individuals, does it already break that assumption?}
\swp{Can we say this?}

There are two components to infection kernels: intrinsic infectiousness of an infected individual (the basic reproductive number) and time distribution of new infections (generation-interval distribution).
Assuming that a population mixes homogeneously, the basic reproductive number -- expected number of secondary cases caused by an \emph{average} primary case in a fully susceptible population -- can be defined as: 
\begin{equation}
\RR_0 = \int K(\tau) d\tau.
\end{equation}
\jd{OK, this one definitely looks problematic; that's not what happens with high degree.}
\swp{Can we just say this? I'm not sure what else we can say.}
Finally, the intrinsic generation-interval distribution is simply the population-level kernel normalized by the basic reproductive number:
\begin{equation}
g(\tau) = \frac{K(\tau)}{\RR_0}.
\end{equation}

\jd{Rewrite these equations a bit more consistently. What are we using for: index infection, current infection? $\tau$ is difference between them. Is it simpler just to use ' for dummies?}
\swp{I tried. $t$ is current time, $\tau$ is time difference. $s$ and $x$ are used for integrals.}
In a homogeneously mixing population, we can assume that the disease incidence $i(t)$ is the product of the current infectiousness of previously infected individuals and the proportion of the population susceptible, $S(t)$.
\begin{equation}
i(t) = S(t) \int K(s) i(t-s) ds = \RR \int g(s) i(t-s) ds,
\end{equation}
where $\RR = S(t) \RR_0$ is the effective reproductive number.
This model, also referred to as the renewal equation, can represent a wide range of epidemic models \citep{heesterbeek1996concept, diekmann2000mathematical, roberts2004modelling, aldis2005integral, wallinga2007generation, roberts2007model}.
Over a period of time where the proportion of susceptible $S$ remains roughly constant, we would expect approximately exponential growth in incidence $i(t)$; assuming $i(t) = i(0) \exp(r t)$ yields the Euler-Lotka equation \citep{lotka1907relation}, which provides a direct link between speed and strength of an epidemic:
\begin{equation}
\frac{1}{\RR} = \int g(s) \exp(-r s) ds.
\end{equation}

\section{Generation-interval distributions across time}

When generation intervals are measured through contact tracing during an outbreak, 
the observed intervals are ``right-censored'', because intervals that end after the observation time are not observed. 
Several studies have associated the backward generation-interval distribution with the early-epidemic observed generation-interval distribution \citep{tomba2010some, nishiura2010time, champredon2015intrinsic, britton2019estimation};
in fact, the censored generation-interval distribution averages over backward generation-interval distributions up until the observation time.
While we mathematically expect these underlying distributions to be the same (and thus the same distribution as their average) during the exponential growth phase, these assumptions can break down as an epidemic progresses.
Here, we want to conceptually distinguish the censored distribution the backward distribution.

The density of new infections occuring at time $t$ caused by infectors who were infected at time $t-\tau$ is given by
\begin{equation}
i_{t-\tau}(t) = \RR i(t-\tau) g(\tau) S(t)
\end{equation}
The backward generation-interval distribution, $b_t(\tau)$, describes a distribution of infection that occured $\tau$ time units before the referece time $t$ and is proportional to $i_{t-\tau}(t)$:
\begin{equation}
b_t(\tau) = \frac{i(t-\tau) g(\tau)}{\int_0^t i(t-s) g(s) ds}
\end{equation}

\jd{Can we just skip this \P, or put in an appendix or something?}
\swp{We decided to ask David for opinion}
\swp{I tried to rewrite the section to make things clearer; it seems to make this paragraph less boring and more relevant?}
On the other hand, the censored generation-interval distribution, $c_t(\tau)$, describes a distribution of \emph{all} infections that are $\tau$ time units apart from any cohort infection time $s$ before $t$.
Then, the censored generation-interval distribution is given by
\begin{equation}\label{eq:obsg}
c_t(\tau) = \frac{g(\tau) \int_0^t i(s-\tau) S(s) ds}{\int_0^t g(x) \int_0^t i(s-x) S(s) ds dx}
\end{equation}
Alternatively, the censored generation-interval distribution can be interpreted as a weighted distribution of the backward generation intervals:
\begin{equation}
c_t(\tau) \propto \int_0^t b_s(\tau) S(s) ds.
\end{equation}
Therefore, we expect the backward generation-interval distribution to be equivalent to the censored generation-interval distribution when $S \approx 1$, i.e., when the epidemic is growing exponentially;
however, this assumption quickly breaks down as the epidemic progresses (Figure~\ref{fig:censor}).

\begin{figure}[!ht]
\includegraphics[width=\textwidth]{../fig/temporal_effect.pdf}
\caption{\textbf{Temporal variation in the mean observed generation interval.}
A deterministic Susceptible-Exposed-Infectious-Recovered (SEIR) model was simulated using Ebola-like parameters and the backward and the censored mean generation interval were calculated over the course of an epidemic.
The dotted horizontal line represents the mean intrinsic generation interval.
}
\label{fig:censor}
\end{figure}

For a single epidemic, the observed mean generation interval through contact tracing will always be shorter than intrinsic mean generation interval (Figure~\ref{fig:censor}).
There are two reasons for this phenomenon.
First, any infection events that occur after the contact tracing period canonot be observed due to right censoring and short generation intervals are more likely to be observed.
In particular, when an epidemic is growing exponentially ($i(t) = i(0) \exp(rt)$), 
the censored generation-interval distribution is equivalent to the inverse exponentially weighted intrinsic generation-interval distribution \citep{britton2019estimation}:
\begin{equation}
\tsub{c}{exp}(\tau) \propto g(\tau) \exp(-r\tau).
\label{eq:exp}
\end{equation}
% As backward generation-interval distributions are always shorter than the intrinsic generation-interval distribution during the exponential growth period, their weighted average (i.e., the censored intervals) will also be shorter.
Second, decreasing number of susceptibles over the course of an epidemic makes long infections less likely to occur, and the realized intervals will always be shorter \citep{champredon2015intrinsic}.
As a result, even if contact tracing is performed through an entire epidemic, the mean intrinsic generation interval will be underestimated.

% When a disease is at (or near) endemic equilibrium, the number of susceptibles remains (approximately) constant over time, and we expect the observed generation-interval distribution to be similar to the intrinsic generation-interval distribution.

\section{Generation-interval distributions across space}

Infected individuals may contact the same susceptible individual multiple times, but only the first effective contact gives rise to infection in a given individual (after this, they are no longer susceptible).
Therefore, we expect realized generation intervals to be shorter than intrinsic generation intervals, on average, in a limited contact network.

To explore the effect of multiple contacts on realized generation intervals, we first consider the infection process from an ``egocentric'' point of view, taking into account infectious contacts made by a single infector.
We define the egocentric kernel as the rate at which secondary infections are realized by a single primary case $a$ in the absence of other infectors:
\jd{We can't use dilution directly in the hazard term: it needs to be multiplied by something like big R. I would put $R\delta$ there. The extreme dilution examples would be mean degree (if highly connected people infect that much more) or individual degree (if they don't infect more at all.)}
\swp{That seems redundant. $K_a$ already has big (individual) R. Why do we multiply by another R? I added more. Is this better?}
\begin{equation}
\hat{K}_a(\tau) = K_a(\tau) \exp \left(- \delta_a \int_0^\tau K_a(s) ds\right),
\end{equation}
where $K_a(\tau)$ is the individual-level intrinsic kernel and $e^{- \delta_a \int_0^\tau K_a(s) ds}$ is the probability that a susceptible acquaintance has not yet been contacted by individual $a$.
The dilution term, $\delta_a$, models how contacts are distributed among susceptible acquaintances.
Throughout this paper, we assume that there is a constant per-pair contact rate $\lambda$ \citep{trapman2016inferring}.
Then, the infectiousness of an individual $\RR_a = \int K_a(s) ds$ is the product of the number of acquaintances $N_a$ and the contact rate $\lambda$; the dilution term is equal to the reciprocal of the number of acquaintances: $\delta_a = 1/N_a$.

The population-level egocentric kernel is given by integrating over individual variations:
\begin{equation}\label{eq:ego}
\hat{K}(\tau) = \int \hat{K}_a(\tau) dA,
\end{equation}
and the population-level egocentric generation-interval distribution is:
\begin{equation}
\hat{g}(\tau) = \frac{\hat{K}(\tau)}{\int \hat{K}(s) ds}.
\label{eq:conditional}
\end{equation}
The population-level egocentric generation-interval distribution describes the distribution of times at which secondary infections are realized by an \emph{average} primary case; 
for brevity we will often omit ``population-level''.
Finally, the egocentric reproductive number can be estimated by integrating over the egocentric kernel $\hat{K}(\tau)$ directly or by applying the Euler-Lotka equation to the egocentric generation-interval distribution \citep{trapman2016inferring}:
\begin{equation}
\frac{1}{\hat{\RR}} = \int \hat{g}(\tau) \exp(-r \tau) d\tau.
\end{equation}
As the egocentric distribution always has a shorter mean than the intrinsic distribution, \Rhat\ will always be smaller than $\RR$ estimated from the intrinsic distribution.
% Similarly, \Rhat\ will be greater than the \emph{true} reproductive number \RR\, since it does not account for depletion of susceptibles by other routes.

For example, consider a susceptible-exposed-infected-recovered (SEIR) model, which assumes that latent and infectious periods are exponentially distributed.
The intrinsic generation-interval distribution that corresponds to this model can be written has \citep{svensson2015influence}:
\begin{equation}
g(\tau) = \frac{\sigma \gamma}{\sigma - \gamma} \left(e^{-\gamma t} - e^{-\sigma t}\right),
\end{equation}
where $1/\sigma$ and $1/\gamma$ are mean latent and infectious periods, respectively.
Assuming a constant per-pair contact rate of $\lambda$ for any pair, we obtain the following egocentric generation-interval distribution:
\begin{equation}
\hat{g}(\tau) = \frac{\sigma (\gamma + \lambda)}{\sigma - (\gamma + \lambda)} \left(e^{-(\gamma + \lambda)t} - e^{-\sigma t}\right)
\end{equation}
In this case, with fixed infectiousness during the infection period, the effect of accounting for pairwise contacts is the same as an increase in the recovery rate: infecting a susceptible contact is analogous to no longer being infectious (since the contact cannot be infected again). 

This calculation can be validated by simulating stochastic infection processes on a ``star'' network (i.e, a single infected individual at the center connected to multiple susceptible individuals who are not connected with each other).
Simulations confirm that in this case the distribution of \emph{contact} times matches the intrinsic generation-interval distribution, while the distribution of realized generation times (i.e., \emph{infection} times) matches the egocentric generation-interval distribution (\fref{local}).

\jd{This is confusing to me. Wouldn't the natural next step be a random network? Homogeneous won't always be shorter than egocentric, I guess. Or are you simulating for a long time? Would it be better to simulate for a shorter time, and add another layer? I was thinking homogeneous $\to$ random $\to$ structured? Doing homogeneous during the exponential period should give us the same as egocentric, right? Maybe we need two figures? Or maybe we don't need a star network at all: first panel of current figure can be done on any network, and second panel can be done on a homogeneous network with a shortish time window?} 
\begin{figure}
\includegraphics[width=\textwidth]{../fig/local_effect.pdf}
\caption{
\textbf{Spatial effects on realized generation intervals.}
Theoretical distributions and means are shown in color (and are the same in each panel, for reference). Simulated distributions and means are shown in black.
(Left) the intrinsic generation-interval distribution corresponds to all contacts by a focal individual, regardless of whether the individual contacted is susceptible (simulated on a star network).
(Middle) the egocentric generation-interval distribution corresponds to the distribution of all infectious contacts by the focal individual with susceptible individuals, in the case where the focal individual is the only possible infector (simulated on a star network).
(Right) realized generation-interval distributions are shorter than egocentric distributions in general, because contacts can be wasted when susceptibles become infected through other routes (simulated on a homogeneous network).
All figures were generated using 5000 stochastic simulations on a network with 5 nodes (1 infector and 4 susceptibles).
}
\label{fig:local}
\end{figure}

The egocentric generation interval \eref{conditional} only explains some of the reduction in generation times that occurs on most networks, however.
Generation intervals are also shortened by indirect connections: a susceptible individual can be infected through another route before the focal individual makes infectious contacts.
Simulations on a small homogeneous network confirm this additional effect (\fref{local}, right panel). 

In general, spatial reduction in the mean generation interval can be viewed as an effect of susceptible depletion and can be further classified into three levels: egocentric, local, and global.
Egocentric depletion, as discussed previously, is caused by an infected individual making multiple contacts to the same individual.
Local depletion refers to a depletion of susceptible individuals in a household or neighborhood;
this effect can be observed early in an epidemic, especially in a highly structured population, even if most of the population remains susceptible.
Finally, global depletion refers to overall depeletion of susceptibility as a population-level and explains the reduction in realized compared to intrinsic generation intervals that occurs even in a well-mixed population (\fref{censor}). 

Although the effect of the overall depletion of susceptible individuals is relatively well-understood \citep{champredon2015intrinsic}, estimating the local effects on observed generation intervals is expected to be a hard problem on realistic networks -- although there has been interesting work on special cases, particularly on hierarchical networks of households nested within communities (e.g.,  \cite{tomba2010some}). \jd{I wonder if any of Frank Ball's household work could be relevant.}
\swp{Will come back.}

\section{Inferring generation-interval distributions from a contact tracing data}

When generation intervals are sampled through contact tracing, there will be four effects present in the sample: (1) right-censoring effect, (2) egocentric depletion effect, (3) local depletion effect and (4) global depletion effect.
We can correct explicitly for the egocentric effect and, in the case of exponential growth, the right-censoring effect.
While the other two effects are difficult to measure, we can make qualitative predictions about their effects on the realized generation intervals and estimated reproductive numbers: 
both local and global depletion effects reduce number of infections that occur and shorten generation intervals.
% SWP: I would rather put these in Discussion?
% but the time scale on which they matter differs:
% local depletion will be important early in an epidemic whereas global depletion will be small until sufficient amount of susceptible individuals become infected.
% As a result, we expect the initial spread of a disease and the realized reproductive number to be heavily dependent on local structure of the contact network near the source of an outbreak.

Since the right-censoring effect is a sampling bias, it must be taken into account explicitly.
In contrast, spatial effects have the same effect on how the epidemic spreads as they do on observed generation intervals. 
We therefore expect that if we correct observed generation intervals for the right-censoring effect, spatial components will be taken into account implicitly. 
We can use these temporally corrected intervals to correctly link $r$ and $\RR$.
Hereafter, we will refer to the temporally corrected distribution as the ``effective'' generation-interval distribution. 
The effective distribution incorporates spatial effects. 
In a large homogeneously mixing population, and during the early phase an an epidemic, the effective distribution will be equivalent to the intrinsic distribution.
\jd{In a network with limited degree, they differ due to egocentric effects; in a non-random network they differ due to local effects; beyond the early period, they differ due to global effects.}

\begin{figure}[ht]
\includegraphics[width=\textwidth]{../fig/cmp_reproductive.pdf}
\caption{\textbf{Comparison of estimates of reproductive number based on various methods.}
Using the observed generation-interval distributions without correcting for right-censoring severely underestimates the reproductive number.
Similarly, using intrinsic and egocentric generation-interval distributions without accounting for local spatial effects overestimates the reproductive number.
Both population-level and individual-level methods provide estimates of reproductive number that are consistent with the empirical estimates, which we define as the average number of secondary cases generated by the first 100 infected individuals.
Boxplots are generated using 100 stochastic simulations of the SEIR model on an empirical network using Ebola-like parameters.
}
\label{fig:cmp}
\end{figure}

Here, we investigate two methods for correcting for temporal bias in a contact tracing data.
We refer to the first method as the population-level method as it relies on the observed distribution aggregated across the entire population.
As the observed generation-interval distribution is a weighted distribution of the effective distribution, the effective distribution can be recovered by taking the inverse of the weights, given by \eref{exp}.
Hence, the population-level method relies on the observed generation intervals and the exponential growth rate \citep{tomba2010some, nishiura2010time, britton2019estimation}:
\begin{equation}
g(\tau) \propto \tsub{c}{exp}(\tau) \exp(r\tau).
\end{equation}
When the susceptible dynamics is known, this equation can be generalized by using \eref{obsg}; we do not pursue this direction here.
The population-level method is simple and intuitive, but does not take into account who infected whom.

We refer to the second method as the individual-level method because it relies on individual contact information.
We model each infection $i$ from an infected individual $j$ as a non-homogeneous Poisson process between the time at which infector $j$ was infected ($t_j$) and the censorship time ($\tsub{t}{censor}$), where the time-varying Poisson rate is equal to the effective generation-interval distribution \citep{daley2007introduction}.
Then, the probability that an individual $j$ infects $n_j$ individuals between $t_j$ and $\tsub{t}{censor}$ is equal to
\begin{equation}
\frac{\RR^{n_j} \exp \big(- \RR G(\tsub{t}{censor} - t_j ;\theta) \big) \prod_{i=1}^{n_j} g(s_{i, j}; \theta)}{n_j!},
\end{equation}
where $s_{i,j}$ is the observed generation interval between infector $j$ and infectee $i$, and $\theta$ is a (vector) parameter of the generation-interval distribution $g$ (and the corresponding cumulative distribution function $G$).
We use gamma distribution to model the effective generation-interval distribution;
parameters $\theta$ correspond to the mean and shape parameters of a gamma distribution.

The entire data likelihood of the individual-level method can be written as:
\begin{equation}
\begin{aligned}
&\mathcal{L}(\RR, \theta\,|\, \mathbf{s}, \mathbf{t}, \mathbf{n}, \tsub{t}{censor})\\
&\quad=\prod_{j=1}^N \left(\RR^{n_j} \exp \big(- \RR G(\tsub{t}{censor} - t_j ;\theta) \big) \prod_{i=1}^{n_j} g(s_{i, j}; \theta) \right),
\end{aligned}
\end{equation}
where $N$ is the total number of infected individuals.
Here, we estimate parameters $\RR$ and $\theta$ by maximum likelihood.
\cite{forsberg2008likelihood} proposed a related approach based on discretized incidence reports.

\swp{Probabaly move simulations to appendix}
To test these methods, we simulate 100 epidemics with Ebola-like parameters on an empirical network and compare the estimates of reproductive number with empirical reproductive numbers, which we define as the average number of secondary cases generated by the first 100 infected individuals (\fref{cmp}).
\cite{trapman2016inferring} estimated the true reproductive number by dividing the total number of infected individuals in generations $2$ to $k+1$ by the total number of infected individuals in generations $1$ to $k$, where the reference generation $k$ is defined to be the first generation that contains at least 75 infected individuals;
however, individuals in later generations are potentially subject to stronger local depletion and even global depletion effects.
Therefore, we expect our empirical estimate to better reflect the infection process during the exponential growth phase.
\swp{TODO: Compare Trapman vs our estimate of empirical R0 in Appendix; Trapman estimate is much lower.}

As we predicted earlier, calculating reproductive number based on the intrinsic generation-interval distribution overestimates the empirical reproductive number;
estimates based on the egocentric generation-interval distribution (\eref{conditional}) are closer to empirical reproductive numbers but still suffer from overestimation as they do not account for indirect spatial effects.
Direct estimates based on contact tracing data severely underestimates the empirical estimates.
While both population- and individual-level corrections provide similar estimates to the empirical reproductive number,
population-level estimates are more variable as they are more sensitive to outliers in generation intervals and our estimate of the growth rate.
For smaller values of \RR, we expect the differences to become smaller. 
\swp{TODO: In Appendix, we present the same figure using Erlang-distributed latent periods, which better corresponds to Ebola. Overall, our qualitative conclusions do not change.}

\section{Discussion}

The intrinsic generation-interval distribution, which describes the expected time distribution of secondary cases, provides a direct link between speed (exponential growth rate, $r$) and strength (reproductive number, $\RR$) of an epidemic \citep{wallinga2007generation, svensson2007note, svensson2015influence, park2019practical}.
However, observed generation-interval distributions can vary depending on how and when it is measured \citep{nishiura2010time, tomba2010some, champredon2015intrinsic, britton2019estimation};
determining which distribution correctly links $r$ and $\RR$ can be challenging.
Here, we analyze how observed generation intervals, measured through contact tracing, vary across time and space.
Temporal variations represent observation bias, whereas spatial variations reflect the contact structure of a realized outbreak.
Therefore, correcting for temporal variation, but not for spatial variation, in an observed generation-interval distribution provides the correct link between $r$ and $\RR$.

Generation intervals can be measured either forward (by tracing the infectees of an infected individual) or backward (by tracing the infector of an infected individual).
Previous studies have characterized changes in these distributions over time by looking at infections that are one generation apart from a single cohort \citep{kenah2008generation, nishiura2010time, tomba2010some, champredon2015intrinsic, britton2019estimation}.
Instead, we considered a slightly different scenario in which generation intervals are measured over multiple generations.
This assumption better reflects real intervention strategies because contact tracing is often performed throughout an ongoing epidemic to prevent further infections. 
In this case, the generation intervals are measured from all observed cases that occured before the last date on which contact tracing was performed.

The observed generation intervals are subject to right-censoring -- it is not possible to trace individuals that have not been incted yet.
During an ongoing outbreak, the observed generation-interval distribution will always have a shorter mean than the intrinsic-interval distribution due to right-censoring.
Near the end of an outbreak, the effect of right-censoring becomes negligible but the observed generation intervals are still shorter on average than the intrinsic generation intervals.
The remaining bias can be explained by depletion of the susceptible population.

We classified susceptible depletion into three levels: egocentric, local, and global.
Egocentric susceptible depletion refers to the effect of an infected individual making multiple contacts to the same susceptible individual.
Accounting for the egocentric effect allowed us to reinterpret the results by \cite{trapman2016inferring} using arguments based on generation intervals.
Local susceptible depletion refers to the effect of other closely related infected individuals (e.g., in a household or neighborhood) making multiple contacts to the same susceptible individual.
Global susceptible depletion refers to the overall decrease in the susceptible pool in the population.

Susecptible depletion happening at all three levels shortens realized generation intervals but acts on different time scales.
Egocentric and local depletion effects are present from the beginning of an epidemic, even when depletion in the global susceptible population is negligible, and can strongly affect the initial spread of an epidemic.
Therefore, we predicted the observed generation intervals during an exponential growth phase to contain information about the contact structure, allowing us to estimate the \emph{effective} generation-interval distribution by simply accounting for the right-censoring.
Simulation studies confirmed our prediction: using the effective generation-interval distribution provides a proper link between $r$ and $\RR$.

We compare two methods for estimating the effective generation-interval distribution and assume that the effective generation-interval distribution follows a gamma distribution.
The gamma approximation of the generation interval distribution has widely used due to its simplicity;
we previously thought that summarizing the entire distribution with two moments (mean and variance) is sufficient to understand the role of generation-interval distributions in linking $r$ and $\RR$.
However, further investigation of our methods suggests that making a wrong distributional assumption leads to narrow confidence intervals, even though the gamma distribution looks indistinguishable from the shape of the intrinsic generation-interval distribution (derived from the SEIR model), making a wrong distributional assumption leads to narrow confidence intervals \swp{Appendix}.
These results are particularly alarming because it is impossible to know the true shape of the distribution [CITE].

\swp{Conclusion?}



\section{Methods}






\bibliography{network}
\end{document}
